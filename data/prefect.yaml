# Prefect Local Deployment Configuration
# Usage: prefect deploy --all

name: newsgest

# Build the Docker image locally
build:
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker>=0.6.0
      dockerfile: Dockerfile
      image_name: newsgest-flows
      tag: latest

# No push for local deployment
push: null

# Pull configuration - use the locally built image
pull:
  - prefect.deployments.steps.set_working_directory:
      directory: /app

deployments:
  - name: news-etl
    description: "Fetches top news headlines and processes them"
    entrypoint: flows/news_etl/news_etl.py:news_etl
    work_pool:
      name: local-docker-pool
      job_variables:
        image: "{{ build-image.image }}"
        image_pull_policy: Never
        env:
          NEWS_API_KEY: "{{ $NEWS_API_KEY }}"
          PREFECT_API_URL: "http://host.docker.internal:4200/api"
    schedules: []
    parameters: {}
    tags:
      - news
      - etl
