# Prefect deployment configuration
# Usage: make deploy ENV=local or make deploy ENV=prod

name: newsgest

# Build configuration for Docker deployments
build:
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker>=0.6.0
      dockerfile: Dockerfile
      image_name: "{{ $DOCKER_REGISTRY | default('') }}newsgest-flows"
      tag: "{{ $IMAGE_TAG | default('latest') }}"
      push: "{{ $PUSH_IMAGE | default('false') }}"

# Push step (only used in production)
push:
  - prefect_docker.deployments.steps.push_docker_image:
      requires: prefect-docker>=0.6.0
      image_name: "{{ build-image.image_name }}"
      tag: "{{ build-image.tag }}"

# Deployments
deployments:
  - name: news-etl
    description: "Fetches top news headlines and processes them"
    entrypoint: flows/news_etl/news_etl.py:news_etl
    work_pool:
      name: "{{ $PREFECT_WORK_POOL | default('local-docker-pool') }}"
    build: "{{ $BUILD_STEPS | default('') }}"
    push: null
    schedules: []
    parameters: {}
    tags:
      - news
      - etl
